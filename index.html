<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ë§ ì˜ ë“£ëŠ” ì‹œë°”ê²¬</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <style>
        /* í™”ë©´ ì „ì²´ ì„¤ì • */
        body { margin: 0; overflow: hidden; background-color: #87CEEB; font-family: sans-serif; }
        
        /* UI ë ˆì´ì•„ì›ƒ - ì•„ì´íŒ¨ë“œì—ì„œë„ ì•ˆ ê°€ë ¤ì§€ê²Œ ìƒë‹¨ì— ë°°ì¹˜ */
        #ui { 
            position: absolute; top: 0; left: 0; width: 100%; 
            padding: 20px 0; background: rgba(0,0,0,0.1); 
            text-align: center; z-index: 1000; 
        }
        
        #status { color: white; font-size: 18px; font-weight: bold; text-shadow: 1px 1px 2px #000; margin-bottom: 10px; }
        
        /* ë²„íŠ¼ ë””ìì¸ */
        button { 
            padding: 15px 30px; font-size: 18px; cursor: pointer; 
            border-radius: 30px; border: none; background: #FFD700; 
            font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            -webkit-appearance: none; /* ì•„ì´íŒ¨ë“œ ê¸°ë³¸ ìŠ¤íƒ€ì¼ ì œê±° */
        }
        
        button:active { background: #ffcc00; transform: scale(0.98); }
    </style>
</head>
<body>
    <div id="ui">
        <div id="status">ì‹œë°”ê²¬ ë¡œë”© ì¤‘...</div>
        <button id="start-btn">ğŸ¤ í´ë¦­í•˜ê³  ëª…ë ¹í•˜ê¸°</button>
    </div>

    <script type="importmap">
        { "imports": { "three": "https://unpkg.com/three@0.160.0/build/three.module.js", "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/" } }
    </script>

    <script type="module">
        import * as THREE from 'three';
        import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';
        import { OrbitControls } from 'three/addons/controls/OrbitControls.js';

        let scene, camera, renderer, mixer, controls, actions = {}, currentAction;
        const clock = new THREE.Clock();

        // 1. ì¥ë©´ ë§Œë“¤ê¸°
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87CEEB);

        camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.set(0, 50, 150);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        controls = new OrbitControls(camera, renderer.domElement);
        controls.target.set(0, 20, 0);
        controls.update();

        // ì¡°ëª…
        scene.add(new THREE.AmbientLight(0xffffff, 2.5));
        const dirLight = new THREE.DirectionalLight(0xffffff, 1.5);
        dirLight.position.set(5, 10, 5);
        scene.add(dirLight);

        // 2. ì‹œë°”ê²¬ ë¶ˆëŸ¬ì˜¤ê¸°
        const loader = new GLTFLoader();
        loader.load('shiba.glb', (gltf) => {
            const model = gltf.scene;
            scene.add(model);
            
            mixer = new THREE.AnimationMixer(model);
            
            // íŒŒì¼ ë‚´ ì‹¤ì œ ì• ë‹ˆë©”ì´ì…˜ ë“±ë¡
            gltf.animations.forEach((clip) => {
                actions[clip.name.toLowerCase()] = mixer.clipAction(clip);
            });

            // ê¸°ë³¸ ë™ì‘(Bounce) ì‹œì‘
            if (actions['bounce']) {
                currentAction = actions['bounce'];
                currentAction.play();
            }

            document.getElementById('status').innerText = "ì‹œë°”ê²¬ ë„ì°©! ëª…ë ¹í•´ë³´ì„¸ìš”.";
            animate();
        });

        function animate() {
            requestAnimationFrame(animate);
            const delta = clock.getDelta();
            if (mixer) mixer.update(delta);
            renderer.render(scene, camera);
        }

        // ë™ì‘ ë°”ê¾¸ê¸° í•¨ìˆ˜
        function changeAction(name) {
            const next = actions[name.toLowerCase()];
            if (next && currentAction !== next) {
                currentAction.fadeOut(0.5);
                next.reset().fadeIn(0.5).play();
                currentAction = next;
            }
        }

        // 3. ì•„ì´íŒ¨ë“œ ëŒ€ì‘ & ìŒì„± ì¸ì‹
        const btn = document.getElementById('start-btn');
        btn.onclick = () => {
            // ì•„ì´íŒ¨ë“œì—ì„œ ë©ˆì¶˜ ì• ë‹ˆë©”ì´ì…˜ì„ ê¹¨ìš°ëŠ” ì½”ë“œ
            if (mixer) mixer.timeScale = 1;
            if (currentAction) currentAction.play();

            const Speech = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (Speech) {
                const rec = new Speech();
                rec.lang = 'en-US';
                rec.start();
                document.getElementById('status').innerText = "ë“£ê³  ìˆì–´ìš”... (Attack, Eat, Fear ë“±)";

                rec.onresult = (e) => {
                    const speech = e.results[0][0].transcript.toLowerCase();
                    document.getElementById('status').innerText = "ëª…ë ¹: " + speech;
                    
                    if (speech.includes('attack')) changeAction('attack');
                    else if (speech.includes('bounce')) changeAction('bounce');
                    else if (speech.includes('eat')) changeAction('eat');
                    else if (speech.includes('click')) changeAction('clicked');
                    else if (speech.includes('fear') || speech.includes('sit')) changeAction('fear');
                };
            }
        };

        // í™”ë©´ í¬ê¸° ì¡°ì ˆ ëŒ€ì‘
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
